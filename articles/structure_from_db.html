<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sourcing structure from database • DataFakeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sourcing structure from database">
<meta property="og:description" content="DataFakeR">
<meta property="og:image" content="https://openpharma.github.io/DataFakeR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataFakeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-thumbs-o-up"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/main.html">Welcome</a>
    </li>
    <li>
      <a href="../articles/datafaker_workflow.html">DataFakeR workflow</a>
    </li>
    <li>
      <a href="../articles/schema_structure.html">YAML schema structure</a>
    </li>
    <li>
      <a href="../articles/structure_from_db.html">Sourcing structure from database</a>
    </li>
    <li>
      <a href="../articles/simulation_options.html">Simulation Options</a>
    </li>
    <li>
      <a href="../articles/simulation_methods.html">Simulation Methods</a>
    </li>
    <li>
      <a href="../articles/extra_parameters.html">Extra parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/openpharma/DataFakeR/issues" class="external-link">
    <span class="fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/DataFakeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sourcing structure from database</h1>
                        <h4 data-toc-skip class="author">Krystian
Igras</h4>
            
            <h4 data-toc-skip class="date">2023-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DataFakeR/blob/HEAD/vignettes/structure_from_db.Rmd" class="external-link"><code>vignettes/structure_from_db.Rmd</code></a></small>
      <div class="hidden name"><code>structure_from_db.Rmd</code></div>

    </div>

    
    
<p>When pulling schema structure directly from database, you may decide
which schema information should be saved in the configuration yaml file.
The proper configuration defined with <code>set_faker_opts</code> should
be passed to <code>faker_opts</code> parameters of
<code>schema_source</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu">source_schema</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="va">conn</span>,</span>
<span>  schema <span class="op">=</span> <span class="st">"public"</span>,</span>
<span>  faker_opts <span class="op">=</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>DataFakeR currently offers two configuration types:</p>
<ul>
<li>column-type specific - allow to configure what type of information
should be stored for each column type,</li>
<li>table specific - allow to configure what table information should be
stored.</li>
</ul>
<div class="section level3">
<h3 id="column-specific-configuration">Column specific configuration<a class="anchor" aria-label="anchor" href="#column-specific-configuration"></a>
</h3>
<p>The current version of DataFakeR package supports five types (R
target types) of columns:</p>
<ul>
<li>character</li>
<li>numeric</li>
<li>integer</li>
<li>logical</li>
<li>date</li>
</ul>
<p>Each column-type configuration is done by setting:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_faker_opts</span>(opt_pull_<span class="sc">&lt;</span>type<span class="sc">&gt;</span> <span class="er">=</span> opt_pull_<span class="sc">&lt;</span>type<span class="sc">&gt;</span>(...))</span></code></pre></div>
<p>The possible configurable parameters are (with supported types):</p>
<ul>
<li>
<code>values (all types)</code> Should column unique values be
sourced? If so the ones are stored as an array withing values
parameter.</li>
<li>
<code>max_uniq_to_pull (all types)</code> Pull unique values only
when the distinct number of them is less than provided value. The
parameter prevents for sourcing large amount of values to configuration
file for example when dealing with ids column.</li>
<li>
<code>nchar (character)</code> Should maximum number of characters
in column be pulled? Is so stored as nchar parameter in configuration
YAML file.</li>
<li>
<code>range    (numeric, integer, date)</code> Should column range
be sourced? Is so stored as range parameter in configuration YAML
file.</li>
<li>
<code>na_ratio (all types)</code> Should column source ratio of NA
values existing in the original column?</li>
</ul>
<p>The information stored by the above parameters may then be used in
the <a href="simulation_methods.html">simulation methods</a>.</p>
<p>The default parameters can be accessed respectively from
<code>default_faker_opts</code> object, for example:</p>
<p>character columns:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_pull_character</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_uniq_to_pull</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nchar</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $na_ratio</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $levels_ratio</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>means, by default we save in the existing column values only when
number of its unique values is less than 10. We will be also storing
maximum number of character for strings in column.</p>
<p>integer columns:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_faker_opts</span><span class="op">$</span><span class="va">opt_pull_integer</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_uniq_to_pull</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $range</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $na_ratio</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $levels_ratio</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>means the same for sourcing possible values as for character type,
more to that we will source the column values range.</p>
<p>Such configuration for sample book authors table, may result with the
below structure:</p>
<table class="table">
<thead><tr class="header">
<th>ID</th>
<th>Author</th>
<th>Digest</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Miss Madelyn Crist MD</td>
<td>Digest A</td>
</tr>
<tr class="even">
<td>2</td>
<td>Merritt Gislason IV</td>
<td>Digest A</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Linton Botsford</td>
<td>Digest A</td>
</tr>
<tr class="even">
<td>4</td>
<td>Isam Bins-Shanahan</td>
<td>Digest A</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Ora Stark</td>
<td>Digest A</td>
</tr>
<tr class="even">
<td>6</td>
<td>Priscila Auer</td>
<td>Digest A</td>
</tr>
<tr class="odd">
<td>7</td>
<td>Ms. Addie Grady DDS</td>
<td>Digest B</td>
</tr>
<tr class="even">
<td>8</td>
<td>Dr. Wayman Halvorson V</td>
<td>Digest B</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Kesha Legros</td>
<td>Digest B</td>
</tr>
<tr class="even">
<td>10</td>
<td>Gay Hoppe</td>
<td>Digest B</td>
</tr>
<tr class="odd">
<td>11</td>
<td>Yolanda Greenholt</td>
<td>Digest B</td>
</tr>
</tbody>
</table>
<pre><code>authors:
  columns:
    ID:
      type: serial
      unique: true
      not_null: true
      default: na.integer
      range: [1, 11]
    author:
      type: varchar
      unique: true
      not_null: true
      default: na.character
      nchar: 23
    digest:
      type: varchar
      unique: false
      not_null: true
      default: na.character
      values: [Digest A, Digest B]
      nchar: 8</code></pre>
<ul>
<li>
<code>type</code>, <code>unique</code>, <code>not_null</code> and
<code>default</code> are always sourced,</li>
<li>range was sourced form integer column,</li>
<li>source table stored information only about two digests (what is less
than 10) so the values are saved,</li>
<li>source table stored information about more than 10 authors (and
ID’s) so such information was not saved,</li>
<li>
<code>nchar = 23</code> means max string length in the author column
was 23 characters.</li>
</ul>
<p>If we want to not source <code>range</code> and <code>nchar</code>
information just precise:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/faker_configuration.html">set_faker_opts</a></span><span class="op">(</span></span>
<span>  opt_pull_integer <span class="op">=</span> <span class="fu"><a href="../reference/sourcing_metadata.html">opt_pull_integer</a></span><span class="op">(</span>range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  opt_pull_character <span class="op">=</span> <span class="fu"><a href="../reference/sourcing_metadata.html">opt_pull_character</a></span><span class="op">(</span>nchar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>and pass <code>my_opts</code> to <code>faker_opts</code> parameter of
<code>schema_source</code> function.</p>
</div>
<div class="section level3">
<h3 id="table-specific-configuration">Table specific configuration<a class="anchor" aria-label="anchor" href="#table-specific-configuration"></a>
</h3>
<p>Can be achieved by specifying <code>opt_pull_table</code> option with
the method of the same name.</p>
<p>In the current version of DataFakeR package only one parameter
(<code>nrows</code>) can be configured, with the three values:</p>
<ul>
<li>
<code>exact</code> - the number of rows of original table will be
stored (and saved in configuration as <code>nrows</code> value),</li>
<li>
<code>ratio</code> - the ratio of rows for table across all the
tables in schema will be stored (and saved in configuration as
<code>nrows</code> value),</li>
<li>
<code>none</code> - number of rows will not be sourced.</li>
</ul>
<p>Such information can be further used to define number of rows in
simulated table (see <a href="simulation_options.html">simulation
options</a>).</p>
<p><strong>Note:</strong> In the future DataFakeR releases the option to
define custom parameters will be enabled.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
